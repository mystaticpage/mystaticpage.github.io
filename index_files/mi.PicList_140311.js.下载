define("tmpl/mu.PicList4v1",'{{#mu_talk}} {{#mu_lineHead}} <li class="clear {{#mu_odd}}odd{{/mu_odd}}{{^mu_odd}}even{{/mu_odd}}"> {{/mu_lineHead}} {{#mu_firstSmall}} <div class="lc_pics_pic4"> {{/mu_firstSmall}} <span id="{{mu_idPrefix}}{{mu_uid}}" data-uid="{{mu_uid}}" class="{{mu_itemClass}} pic_{{#mu_picMin}}min{{/mu_picMin}}{{^mu_picMin}}max{{/mu_picMin}}" rel="{{timestamp}}"><a href="{{#mu_getTalkUrl}}{{id}}{{/mu_getTalkUrl}}" target="{{mu_target}}" class="clk-1 pic_lk"><img src="{{&mu_imgUrl}}"{{&mu_imgAttr}}/></a></span> {{#mu_lastSmall}} </div> {{/mu_lastSmall}} {{#mu_lineTail}} </li> {{/mu_lineTail}} {{/mu_talk}}');define("tmpl/mu.PicList",'{{#mu_talk}} <div class="imgView" id="{{mu_idPrefix}}{{mu_uid}}" data-uid="{{mu_uid}}" rel="{{mu_time}}"><div class="zfcnt">{{mu_rtcount}}</div><a href="{{#mu_getTalkUrl}}{{mu_id}}{{/mu_getTalkUrl}}" target="{{mu_target}}" class="clk-1"><img {{#mu_noDelay}}onerror="MI.picError(this)" src="{{/mu_noDelay}}{{^mu_noDelay}}class="crs loading" crs="{{/mu_noDelay}}{{&mu_imgUrl}}" alt=""{{&mu_imgAttr}}{{&mu_quickReg}}/> {{qqTabSpan}} </a></div> {{/mu_talk}}');(function(){MI.PicList=function(a,c){var b=this,d,e;UI.isString(a)?d=UI.G(a):(d=a,e=UI.A(a,"id"),e||(e="piclist"+UI.random(1E4),UI.A(a,"id",e)),a=e);if(!d)throw Error("No container found for PicList: "+a);if(MI.PicList.instanceIds[a])throw Error("PicList: "+a+" has already been initialized.");MI.PicList.instanceIds[a]=!0;this.config=this._preprocCfg(c||{});this._lists=(e=this.config.list)?UI.isString(e)?UI.GC(d,e)[0]:e:d;if(!this._lists)throw Error("No lists found for PicList");this.config.list4to1&&(d.className="lc_pics clear",d.innerHTML='<ul class="lc_pics_lst"></ul>',this._lists=d.firstChild,this.reservedTalk=[]);this.id=a;this.container=d;this.hasMore=!0;this.page=1;this.tmplData={};this.content=this.active=null;this._addEvents();d=UI.isString(this.config.moreBtn)?UI.G(this.config.moreBtn):this.config.moreBtn;this.config.moreBtn=d||"";if(this.config.doMore){if(d){if(this._more=UI.GC(d,"a")[0])this._more.onmouseover=MI.hideFocus,this._more.onclick=function(a){b.more();UI.E(a).prevent()};setTimeout(function(){b.cacheLast()},0);this.config.autoMore&&this.autoMore()}}else this.noMore=!0;if(6===MI.PicList.IE_VER)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(g){}this.config.merge||(MI.user.fun.mergePic=0);this.items().length?this.autoRun():this.showEmpty()};MI.PicList.instanceIds={};MI.PicList.IE_VER=UI.B.ie;var q=MI.PicList,k;k=UI.B;var n=navigator.userAgent;k=k.chrome?n.match(/Chrome\/\d+/)[0]:k.firefox?n.match(/Firefox\/\d+/)[0]:k.ie?"MSIE/"+MI.PicList.IE_VER:k.ipad?"iPad/"+n.match(/Version\/(\d+)/)[1]:k.opera?"Opera/"+n.match(/Version\/(\d+)/)[1]:k.safari?"Safari/"+n.match(/Version\/(\d+)/)[1]:n;k=encodeURIComponent(k);q.UA=k;MI.PicList.bind=function(a,c){return function(){a.apply(c,Array.prototype.slice.call(arguments))}};MI.PicList.contains=document.documentElement.compareDocumentPosition?function(a,c,b){return!a||!c||!c.tagName?!1:b&&a===c||!!(c.compareDocumentPosition(a)&16)}:document.documentElement.contains?function(a,c,b){if(!a||!c||!c.tagName)return!1;3===a.nodeType&&(a=a.parentNode,b=!0);return b&&a===c||c.contains(a)}:function(){};MI.PicList.breakWord=function(a){return!a||1!==a.nodeType?!1:a.currentStyle&&"string"===typeof a.currentStyle.wordBreak?(MI.PicList.breakWord=function(a){a.runtimeStyle.wordBreak="break-all";return!0},MI.PicList.breakWord(a)):document.createTreeWalker?(MI.PicList.breakWord=function(a){for(var a=document.createTreeWalker(a,NodeFilter.SHOW_TEXT,null,!1),b,d,e=String.fromCharCode("8203");a.nextNode();)b=a.currentNode,d=b.nodeValue.replace(/^\s\s*|\s*\s$/g,"").split("").join(e),b.nodeValue=d;return!0},MI.PicList.breakWord(a)):!1};MI.PicList.getWindowXY=function(){var a=window.innerHeight,c=window.innerWidth,b=document.compatMode;if(b||UI.B.ie)"CSS1Compat"===b?(a=UI.B.opera?a:document.documentElement.clientHeight,c=document.documentElement.clientWidth):(a=UI.B.opera?a:document.body.clientHeight,c=document.body.clientWidth);return[c,a]};MI.PicList.getDocumentXY=function(){var a,c,b;"CSS1Compat"!==document.compatMode||UI.B.webkit?(a=document.body.scrollWidth,c=document.body.scrollHeight):(a=document.documentElement.scrollWidth,c=document.documentElement.scrollHeight);b=MI.PicList.getWindowXY();return[Math.max(a,b[0]),Math.max(c,b[1])]};MI.PicList.getTpJsFromPhp=function(a){return{1:null,2:1,3:3,4:2,5:2,6:null,7:4}[a]};MI.PicList.adjustAutoLoadIndex=function(a,c){var b=this.autoLoadIndex;0>=b||(1===a?b=700>c?b+2:700<=c&&1E3>c?b-1:1E3<=c&&2E3>c?b-2:2E3<=c?Math.ceil(b/2)-1:b-1:2===a&&1E3<c&&(b-=1),b=Math.min(b,45),0>=b&&(this.doAutoLoad=!1),this.autoLoadIndex=b)};MI.PicList.getTidFromId=function(a){return(a=a.match(/([0-9]{5,})-?(r?)([0-9])?$/))&&a[1]||null};MI.PicList.addImgProperty=function(a){return a};MI.PicList.copyMultiPic=function(a,c,b){var d=[];UI.each(a,function(a){var g=a.img,j=!1,f,i,o,l,h,m;a.source&&(g=a.source.img,j=!0);c&&(j&&a.img&&a.img.length)&&(o={},i=[],f=0,UI.each(UI.GC(UI.html("<div>"+a.content+"</div>")[0],"i.ic.ic_pic"),function(a){var c=UI.A(a,"data-rpurl");i.push(c);o[c]=UI.A(a,"data-rpid");f++;if(b)return true}),0<f&&(o.count=f,a._rtMap=o,UI.each(i,function(b){var c;UI.each(a.img,function(a,d){if(a.url===b){c=d;return true}});if(c>-1){h=UI.clone(a);l=h.img[c];l._rtid=String(o[b]);h.img=[l];h.imageInfo=l;h.image=[l.url];h.source.img=[];h.source.image=[];h.source.imageInfo=null;d.push(h)}})));g&&(1<g.length?UI.each(g,function(b,c){h=UI.clone(a);m=j?h.source:h;l=m.img[c];l._mid=String(c);m.img=[l];m.imageInfo=m.img;m.image=[b.url];d.push(h)}):1===g.length&&(h=UI.clone(a),m=j?h.source:h,m.img[0]._mid="0",d.push(h)))});return d};MI.PicList.getUidForPic=function(a,c,b){c=parseInt(c,10);b=parseInt(b,10);0<=c&&8>=c?a+="-"+c:1<=b&&9>=b&&(a+="-r"+b);return a};MI.PicList.forceIeRefresh=function(a){var c=this.IE_VER;c&&(8>document.documentMode||8>c)&&a.parentNode.appendChild(a)};MI.PicList.CLICK_REG=/clk-([a-z0-9\-]+)(?:\s+|$)/;MI.PicList.MO_REG=/clk-mo-([a-z0-9]+)(?:\s+|$)/;MI.PicList.HASH_REG=/([a-z0-9A-Z]){20}/;MI.PicList.MAX_UNEXPD_HEIGHT=350;MI.PicList.MIN_WIDTH=420;MI.PicList.MAX_WIDTH=460;MI.PicList.MODAL_WIDTH=800;MI.PicList.PAGE_WIDTH=MI.PicList.getDocumentXY()[0];MI.PicList.ARROW_SIZE=49;MI.PicList.doAutoLoad=!0;MI.PicList.autoLoadIndex=8;MI.PicList.prototype._mapClick={1:function(a){var a=a.parentNode,a=UI.A(a,"data-uid")||a.id,c=this.config;c.list4to1?MI.Bos({name:"btnPVGuest4to1",id:1193}):"search.t.qq.com"===location.host?MI.Bos({name:"btnPVSearch",id:1193}):"k.t.qq.com"===location.host?MI.Bos({name:"btnPVTopic",id:1193}):"top-pic-list"===this.id?MI.Bos({name:"btnPVTop",id:1193}):c.owner?MI.Bos({name:"btnPVGuestTl",id:1193}):MI.Bos({name:"btnPVMyTl",id:1193});if(!c.onclick)return!0;this.activeDlg!==a&&c.onclick&&c.onclick.call(this,a)},3:function(){MI.Bos("btnPicListTopMore");return!0}};MI.PicList.prototype._preprocCfg=function(a){var c={},b=function(b,e){var g;"number"===typeof e?(g=a[b],c[b]=parseInt(g,10)===g?g:e||0):"boolean"===typeof e?(e=!!e,g=!e,c[b]=a[b]===g?g:e):c[b]=a[b]||e};b("direction",0);b("arrPos",0);b("headHeight",0);b("searchPage",0);b("fitWidth",120);b("fitHeight",120);b("doMore",!0);b("autoMore",!0);b("merge",!1);b("autoScroll",!0);b("isGuest",!1);b("pptMode",!0);b("showHot",!0);b("noTip",!1);b("list4to1",!1);b("moreBtn","moreList");b("itemClass",c.list4to1?"imgView2":"imgView");b("idPrefix","");b("autorunId","");b("moreCall");b("list");b("owner",c.isGuest?MI.guest.user:"");b("ownerNick",c.isGuest?MI.guest.nickName:"");b("onlyOwner",c.onlyOwner||"");b("onclick",c.pptMode?function(b){this.showModalDlg(b)}:null);c.list4to1&&(c.noTip=!0,c.fitWidth=126,c.fitHeight=126);return c};MI.PicList.prototype.autoResize=function(a,c){var b=this;UI.each(a,function(a,e){var g={},j,f,g=a._imgDatum;j=b.config.fitWidth;f=b.config.fitHeight;if(b.config.list4to1&&(c&&0===e%5||!c&&4===e%5))f=j=275;a._imgInfo=MI.calcImgInfo({h:f,w:j},{h:g.height,w:g.width});a.mu_imgUrl=a._imgDatum.url+"/"+a._imgInfo.id;a.mu_imgAttr=a._imgInfo.attr;4===e%5&&(c=!c)})};MI.PicList.prototype._addEvents=function(){var a=document.body,c=this.container;this.events={click:MI.PicList.bind(this._hlClick,this)};UI.EA(a,"click",this.events.click);MI.Crs.onLoadResize&&UI.each(UI.GC(c,".clk-1 img"),function(a){UI.EA(a,"load",MI.Crs.onLoadResize);MI.Crs.onLoadResize(a)})};MI.PicList.prototype._hlClick=function(a){var c,b,d=3,e,g,j;j=UI.E(a);c=j.target;e=MI.PicList.CLICK_REG;g=this._mapClick;if(MI.PicList.contains(c,this.container))for(;0<d--&&c;){b=(b=c.className&&c.className.match(e))&&b[1];if(g[b]){!0!==g[b].apply(this,[c,a])&&(j.stop(),j.prevent());break}c=c.parentNode}};MI.PicList.prototype.more=function(a,c,b){var d,e,g,j,f,i=this;MI.Base&&this.last&&(this.noMore||!this.hasMore?(UI.addClass(this.config.moreBtn,"undis"),this.more=function(){},this.noMore=!0,this.hasMore=!1):(c={r:MI.random(),time:i.last.time,id:i.last.id,page:i.page+1},f=UI.A(this._more,"rel"),this.config.searchPage&&(c.p=this.config.searchPage),this.config.owner&&(c.u=this.config.owner),i._more.sending||(UI.addClass(i._more,"loading"),f&&(d=+new Date,MI.ajax({url:f,type:"get",data:c,timeout:3E4,fail:function(){e=+new Date-d;MI.PicList.adjustAutoLoadIndex(1,e);UI.removeClass(i._more,"loading");i._more.sending=0},success:function(a){e=+new Date-d;MI.PicList.adjustAutoLoadIndex(1,e);i.page=i.page+1;i.addMore(a);i.config.searchPage&&i.config.searchPage++;g=+new Date-d;setTimeout(function(){j=+new Date-d;MI.Speed("t_asyn_more",0.005,e,g,j)},0);b&&b(a)}}),MI.Bos(a?"btnPicMoreAuto":"btnPicMore"))),i._more.sending=1))};MI.PicList.prototype.addMore=function(a,c){var b,d,e,g,j,f=this,i=UI.isString(a),k=this.items(),l,h,m,n,p;if((b=i?MI.json(a):a)&&0===b.result){if(!f.config.owner&&b.info.user!==MI.user.account){document.location.reload();return}b.info.guest=f.guest;b.info.fav=f.last&&f.last.fav?1:0;b.info.iconPic=f.iconPic;!this.totalNum&&b.info.total&&(this.totalNum=b.info.total);this.hasMore=!!b.info.talk.length;p=b.info.talk[b.info.talk.length-1];this.config.searchPage&&15*this.config.searchPage>this.totalNum&&(this.hasMore=!1);b.info.talk=this.preProcessPic(b.info.talk,!1,this.config.onlyOwner);b.info.showHot=f.config.showHot;d=document.createDocumentFragment();UI.each(["fitWidth","fitHeight","onlyOwner"],function(a){b.info[a]=f.config[a]});if(n=this.config.list4to1)l=this.reservedTalk.concat(b.info.talk),0!==b.info.hasNext?(b.info.talk=l.slice(0,5*Math.floor(l.length/5)),this.reservedTalk=l.slice(5*Math.floor(l.length/5))):(b.info.talk=l,this.reservedTalk=[]),b.info._isOdd=h=0===Math.ceil(k.length/5)%2,m=b.info.talk.length;UI.each(b.info.talk,function(a,b){if(n){var c=b%5;if(c===0){if(h=!h)a.mu_firstSmall=true;a.mu_lineHead=true}else if(c===1&&!h)a.mu_firstSmall=true;if(h&&c<4||!h&&c>0)a.mu_picMin=true;if(h&&(c===3||c<3&&b===m-1)||!h&&(c===4||c>0&&b===m-1))a.mu_lastSmall=true;if(c===4||b===m-1)a.mu_lineTail=true}a.mu_uid=a._imgDatum.uid;a.mu_odd=h;a.mu_id=a.id;a.mu_time=a.timestamp;a.mu_rtcount=(a._imgDatum.id===a.id?a:a.source).count});b.info.mu_idPrefix=this.config.idPrefix;b.info.mu_target=3===MI.hostType?"_self":"_blank";b.info.mu_itemClass=this.config.itemClass;b.info.mu_quickReg=MI.user.account?"":" onclick=\"mb_quick_reg(this, '');return false\"";b.info.mu_getTalkUrl=function(a,b){return MI.getInternalUrl(1,b?b(a):a)};f.autoResize(b.info.talk,b.info._isOdd);b.info.talk.length?(k=function(a){e=UI.html(a);g=0;for(j=e.length;g<j;g++)UI.append(e[g],d);UI.append(d,f._lists);UI.B.ie||MI.GoTop.position();MI.dialog&&MI.dialog.display&&MI.dialog.resizeBg();f.activeDlg&&f._modalDlg.resizeBg();c||MI.PV(MI.api.type===5?"mb/qzone/more":"more");i&&UI.isNumber(MI.ajaxTimes)&&MI.ajaxTimes++;f.hideEmpty();f._more&&MI.PicList.forceIeRefresh(f._more.parentNode);f.autoRun();f.cacheLast();f.moreCall&&f.moreCall();MI.Crs(1,f._lists)},b.info.mu_talk=b.info.talk,MI.mustacheTmpl(this.config.list4to1?"PicList4v1":"PicList",b.info,k)):1!==b.info.hasNext&&0===k.length&&this.showEmpty();1!==b.info.hasNext||!f.hasMore?(f._more&&UI.addClass(f._more.parentNode,"hide"),f.more=function(){},f.noMore=!0,f.hasMore=!1):0===b.info.talk.length&&p&&(this.last={id:p.id,time:p.timestamp},this.more(!0));f.moreTimes++}UI.removeClass(f._more,"loading");f._more&&(f._more.sending=0)};MI.PicList.prototype.preProcessPic=function(a,c,b){var d=[],e,g=!0;MI.PicList.addImgProperty(a);c||(g=!MI.user.fun.noPLRtp,a=MI.PicList.copyMultiPic(a,g,b));UI.each(a,function(a){var c;if(a){a._imgDatum=a.img[0];if((c=a.source)&&c.img&&c.img[0]){a._imgDatum=c.img[0];a._imgDatum.owner=c.name;a._imgDatum.id=c.id}else if(a._imgDatum){a._imgDatum.owner=a.name;a._imgDatum.id=a.id}if(e=a._imgDatum){if(e.width>9999||e.height>9999)e.width=e.height=0;e.uid=MI.PicList.getUidForPic(a.id,e._mid,e._rtid);(!b||e.owner===b)&&d.push(a)}}});return d=this.removeRepeat(d)};MI.PicList.prototype.removeRepeat=function(a){function c(a){return(a=a.match(MI.PicList.HASH_REG))&&a.length?a[0]:""}var b=this,d;d=[];if(!UI.isArray(a))return d;this.mapCache||(this.mapCache={},UI.each(this.items(),function(a){(a=UI.GC(a,".clk-1 img")[0])&&(b.mapCache[c(a.src||UI.A(a,"crs"))]=!0)}));UI.each(a,function(a){var g=c(a._imgDatum.url);if(g&&!b.mapCache[g]){d.push(a);b.mapCache[g]=a.id}});return d};MI.PicList.prototype.autoMore=function(){var a,c,b,d=this;c=function(){clearTimeout(a);a=setTimeout(b,200)};b=function(){MI.PicList.doAutoLoad&&900>UI.pageHeight()-UI.scrollY()-UI.windowHeight()?d.more(1):MI.PicList.doAutoLoad||UI.ER(window,"scroll",c)};this.moreTimes=0;this.events.am=c;UI.EA(window,"scroll",c)};MI.PicList.prototype.cacheLast=function(){for(var a=this.items(),c=a.length,b=a[--c];b&&!this.isItem(b);)b=a[--c];b&&(a=UI.A(b,"rel"),b=MI.PicList.getTidFromId(b.id),this.last={id:b,time:a},this.config.list4to1&&this.reservedTalk.length&&(b=this.reservedTalk[this.reservedTalk.length-1],this.last={id:b.id,time:b.timestamp}))};MI.PicList.prototype.bottom=function(){var a,c,b,d,e=this._lists;if(e&&(a=UI.GC(".main .imgMod"),c=UI.parents(e,"main")[0],d=0,c&&(b=c.parentNode),a.length||(a=UI.GC(".imgMod")),(a=a[a.length-1])&&UI.height(e))){UI.C(a,"marginBottom",0);if(c)d=UI.height(c)-UI.height(b);else if(b=UI.G("mainWrapper"))UI.each(b.childNodes,function(a){a.nodeType===1&&(d=d+UI.height(a))}),d-=UI.height(b);UI.C(a,"marginBottom",-1>d?-d+"px":"")}MI.bottom&&MI.bottom()};MI.PicList.prototype.isItem=function(a){if(UI.hasClass(a,this.config.itemClass)&&a.id)return!0};MI.PicList.prototype.items=function(){var a=[];UI.each(UI.GC(this._lists,"."+this.config.itemClass),function(c){c.id&&a.push(c)});return a};MI.PicList.prototype.next=function(a){var c,b;this.config.list4to1?(b=this.items(),UI.each(b,function(d,e){if(d===a)return c=b[e+1],!0})):c=UI.next(a);if(UI.hasClass(c,this.config.itemClass)&&c.id)return c};MI.PicList.prototype.prev=function(a){var c,b;this.config.list4to1?(b=this.items(),UI.each(b,function(d,e){if(d===a)return c=b[e-1],!0})):c=UI.prev(a);if(UI.hasClass(c,this.config.itemClass)&&c.id)return c};MI.PicList.prototype.showEmpty=function(){var a=this._lists,c=this,b=10,d=UI.GC(a,".noPubs")[0],e;d||(d=UI.html('<div class="noPubs">'+_("暂时没有图片可以看哦")+"</div>")[0],a.appendChild(d));this.toidEmpty=e=setInterval(function(){c.bottom();b--<1&&clearInterval(e)},1E3);UI.show(d);UI.addClass(this.config.moreBtn,"undis")};MI.PicList.prototype.hideEmpty=function(){var a=UI.GC(this._lists,".noPubs")[0];clearInterval(this.toidEmpty);a&&UI.hide(a);UI.removeClass(this.config.moreBtn,"undis")};MI.PicList.prototype.reset=function(){this.reservedTalk=[];this._lists.innerHTML="";this.mapCache=null};MI.PicList.prototype.showFirstModal=function(){var a=this.items();a&&a[0]&&this.showModalDlg(a[0].id)};MI.PicList.prototype.showModalDlg=function(a){var c={picList:this,albumOwnerNick:this.config.ownerNick||this.config.owner||"",albumOwner:this.config.owner||""},b=this;MI.guest?"qzphoto-piclist-all"===this.id?(c.bosCodeSBak1="web.wide.guest.album",c.onlyOwner=this.config.onlyOwner||MI.guest.user||""):"top-pic-list"===this.id?(c.bosCodeSBak1="web.wide.guest.topalbum",c.onlyOwner=this.config.onlyOwner||MI.guest.user||""):"pic-list"===this.id&&(c.bosCodeSBak1="web.wide.guest.piclist"):5===MI.api.type?"pic-list"===this.id&&(c.bosCodeSBak2="web.qz.home.piclist",delete c.picList,c.attachURL=qOP.adapter.getInfo("piclistAttachUrl")):"k.t.qq.com"===location.host&&"pic-list"===this.id?c.bosCodeSBak1="web.wide.topic":"search.t.qq.com"===location.host&&"pic-list"===this.id?c.bosCodeSBak1="web.wide.search":"t.qq.com"===location.host&&"pane-pic-list"===this.id&&(c.bosCodeSBak1="web.wide.home.piclist");5==MI.api.type?MI.app("lib/underscore",function(d){var e=d.values(b.mapCache),e=d.uniq(e);e.length>100&&(e=e.slice(e.length-100));MI.cPlayer.view(a,e,c)}):MI.cPlayer.view(a,c)};MI.PicList.prototype.autoRun=function(){var a,c=this.config.autorunId,b;c&&(b=this.items(),a=b[0].id,UI.each(b,function(b){if(MI.PicList.getTidFromId(b.id)===c)return a=b.id,!0}),this.showModalDlg(a),this.config.autorunId="")};MI.PicList.prototype.destroy=function(){var a=this.events;UI.ER(document.body,"click",a.click);a.am&&UI.ER(window,"scroll",a.am);this.events=null;this._lists.innerHTML="";this._elClose=this._more=this._lists=null;delete MI.PicList.instanceIds[this.id]};MI.app({Base:function(){MI.PicList.addImgProperty=MI.addImgProperty}});window.mb_quick_reg||(window.mb_quick_reg=function(){})})();/*version:137126*//*  |xGv00|b6a1fb0ba0c09ac54afbd2e463fbaba6 */